<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B·∫£ng ƒêi·ªÅu Khi·ªÉn Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    h1 {
      color: #333;
      margin-bottom: 30px;
      text-align: center;
    }

    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .section h2 {
      color: #555;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #666;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
      transform: translateY(-2px);
    }

    .btn-info {
      background: #17a2b8;
      color: white;
    }

    .btn-info:hover {
      background: #138496;
      transform: translateY(-2px);
    }

    .btn-warning {
      background: #ffc107;
      color: #333;
    }

    .btn-warning:hover {
      background: #e0a800;
      transform: translateY(-2px);
    }

    .status {
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-weight: bold;
    }

    .status.connected {
      background: #d4edda;
      color: #155724;
    }

    .status.disconnected {
      background: #f8d7da;
      color: #721c24;
    }

    .test-section {
      background: #fff3cd;
    }

    .auto-section {
      background: #e7f3ff;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
    }

    .inline-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .player-list {
      max-height: 200px;
      overflow-y: auto;
      background: white;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }

    .player-item {
      padding: 8px;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .player-item:last-child {
      border-bottom: none;
    }

    .player-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
    }

    .log-section {
      max-height: 150px;
      overflow-y: auto;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
    }

    .log-item {
      padding: 3px 0;
      color: #666;
    }

    .log-item.success {
      color: #28a745;
    }

    .log-item.error {
      color: #dc3545;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéÆ B·∫£ng ƒêi·ªÅu Khi·ªÉn Game</h1>

    <div class="section">
      <h2>üì° Tr·∫°ng Th√°i K·∫øt N·ªëi</h2>
      <div id="status" class="status disconnected">Ch∆∞a k·∫øt n·ªëi</div>
      <div style="margin-top: 10px;">
        <strong>ID Ph√≤ng:</strong> <span id="roomId">-</span>
      </div>
      <div style="margin-top: 5px;">
        <strong>Tr·∫°ng th√°i Game:</strong> <span id="gameState">-</span>
      </div>
      <div style="margin-top: 5px;">
        <strong>S·ªë ng∆∞·ªùi ch∆°i:</strong> <span id="playersCount">0</span>
      </div>
    </div>

    <div class="section">
      <h2>‚öôÔ∏è C·∫•u H√¨nh Game</h2>
      
      <div class="form-group">
        <label>ID Ph√≤ng:</label>
        <input type="text" id="inputRoomId" value="test-room-123" />
      </div>

      <div class="form-group">
        <label>Ch·ªß ƒë·ªÅ:</label>
        <select id="theme">
          <!-- <option value="duck">V·ªãt ü¶Ü</option>
          <option value="horse">Ng·ª±a üê¥</option>
          <option value="cow">B√≤ üêÑ</option> -->
          <option value="unicorn">K·ª≥ L√¢n ü¶Ñ</option>
          <!-- <option value="car">Xe H∆°i üöó</option>
          <option value="bear">G·∫•u üêª</option> -->
        </select>
      </div>

      <div class="form-group">
        <label>T·ª´ kh√≥a:</label>
        <input type="text" id="keyword" value="hanagold" />
      </div>

      <div class="form-group">
        <label>Ch·∫ø ƒë·ªô ch∆°i:</label>
        <select id="mode">
          <option value="random">Ng·∫´u nhi√™n</option>
        </select>
      </div>

      <div class="inline-group">
        <div class="form-group">
          <label>Th·ªùi gian (GG:PP:SS):</label>
          <input type="text" id="timer" value="00:00:30" />
        </div>

        <div class="form-group">
          <label>S·ªë ng∆∞·ªùi th·∫Øng:</label>
          <input type="number" id="winnersCount" value="3" min="1" max="10" />
        </div>
      </div>

      <div class="inline-group">
        <div class="form-group">
          <label>S·ªë ng∆∞·ªùi t·ªëi ƒëa:</label>
          <input type="number" id="maxCharacters" value="50" min="1" max="1000" />
        </div>

        <div class="form-group">
          <label>√Çm l∆∞·ª£ng (0-100):</label>
          <input type="number" id="volume" value="50" min="0" max="100" />
        </div>
      </div>

      <div class="form-group checkbox-group">
        <input type="checkbox" id="enableSound" checked />
        <label for="enableSound" style="margin-bottom: 0;">B·∫≠t √¢m thanh</label>
      </div>

      <button class="btn-primary" onclick="saveConfig()">üíæ L∆∞u C·∫•u H√¨nh</button>
    </div>

    <div class="section">
      <h2>üéØ ƒêi·ªÅu Khi·ªÉn Game</h2>
      <div class="button-group">
        <button class="btn-success" onclick="initGame()">üé¨ Kh·ªüi T·∫°o</button>
        <button class="btn-success" onclick="runGame()">‚ñ∂Ô∏è B·∫Øt ƒê·∫ßu</button>
        <button class="btn-danger" onclick="resetGame()">üîÑ L√†m M·ªõi</button>
        <button class="btn-info" onclick="showTopWinners()">üèÜ Top Th·∫Øng</button>
        <button class="btn-info" onclick="showResultList()">üìã K·∫øt Qu·∫£</button>
      </div>
    </div>


    <div class="section auto-section">
      <h2>ü§ñ T·ª± ƒê·ªông Th√™m Ng∆∞·ªùi Ch∆°i</h2>
      
      <div class="inline-group">
        <div class="form-group">
          <label>S·ªë l∆∞·ª£ng ng∆∞·ªùi:</label>
          <input type="number" id="autoPlayerCount" value="10" min="1" max="50" />
        </div>

        <div class="form-group">
          <label>Kho·∫£ng th·ªùi gian (ms):</label>
          <input type="number" id="autoInterval" value="1000" min="100" max="5000" step="100" />
        </div>
      </div>

      <div class="button-group">
        <button class="btn-warning" onclick="addRandomPlayers()">üé≤ Th√™m Ng·∫´u Nhi√™n</button>
        <!-- <button class="btn-warning" onclick="startAutoAddPlayers()">‚ñ∂Ô∏è B·∫Øt ƒê·∫ßu T·ª± ƒê·ªông</button>
        <button class="btn-danger" onclick="stopAutoAddPlayers()">‚èπÔ∏è D·ª´ng T·ª± ƒê·ªông</button> -->
        <button class="btn-info" onclick="clearAllPlayers()">üóëÔ∏è X√≥a T·∫•t C·∫£</button>
      </div>

      <div style="margin-top: 15px;">
        <strong>Danh s√°ch ng∆∞·ªùi ch∆°i ƒë√£ th√™m:</strong>
        <div id="playerList" class="player-list"></div>
      </div>
    </div>

    <div class="section">
      <h2>üìä Nh·∫≠t K√Ω Ho·∫°t ƒê·ªông</h2>
      <div id="logSection" class="log-section">
        <div class="log-item">S·∫µn s√†ng...</div>
      </div>
      <button class="btn-info" onclick="clearLogs()" style="margin-top: 10px;">üóëÔ∏è X√≥a Nh·∫≠t K√Ω</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const API_BASE_URL = 'https://server-game-zk1e.onrender.com';
    const socket = io(API_BASE_URL);
    let currentRoomId = document.getElementById('inputRoomId').value;
    let gameState = {
      state: 'pending',
      count: 0
    };
    let autoAddInterval = null;
    let addedPlayers = [];

    // Danh s√°ch t√™n ti·∫øng Vi·ªát
    const vietnameseNames = [
      'Nguy·ªÖn VƒÉn An', 'Tr·∫ßn Th·ªã B√¨nh', 'L√™ Ho√†ng C∆∞·ªùng', 'Ph·∫°m Th·ªã Dung',
      'Ho√†ng VƒÉn Em', 'ƒê·∫∑ng Th·ªã Ph∆∞∆°ng', 'V≈© Minh Giang', 'B√πi Th·ªã H√†',
      'ƒê·ªó VƒÉn H√πng', 'Ng√¥ Th·ªã Lan', 'D∆∞∆°ng VƒÉn Khoa', 'Phan Th·ªã Linh',
      'Mai VƒÉn Minh', 'Tr∆∞∆°ng Th·ªã Nga', 'L√Ω VƒÉn Nh√¢n', 'V√µ Th·ªã Oanh',
      'T·∫° VƒÉn Ph√∫c', 'ƒêinh Th·ªã Qu·ª≥nh', 'Chu VƒÉn Sang', 'ƒêo√†n Th·ªã Th·∫£o',
      'H·ªì VƒÉn Th·∫Øng', 'L∆∞u Th·ªã Uy√™n', 'Cao VƒÉn Vinh', 'Th√°i Th·ªã Xu√¢n',
      'T√¥ VƒÉn Y√™n', 'Ki·ªÅu Th·ªã H∆∞∆°ng', 'La VƒÉn Tu·∫•n', 'Ma Th·ªã Mai',
      'Nghi√™m VƒÉn Nam', '√îng Th·ªã Ph∆∞·ª£ng', 'Quan VƒÉn Quang', 'T·ªëng Th·ªã R·∫°ng',
      'Ung VƒÉn S∆°n', 'VƒÉn Th·ªã T√¢m', 'Xa VƒÉn Trung', 'Y√™n Th·ªã Ng·ªçc',
      'ƒêi·ªÅn VƒÉn ƒê·ª©c', '√Çu Th·ªã H·∫±ng', 'B·∫°ch VƒÉn H·∫£i', 'Cam Th·ªã Kim',
      'ƒêan VƒÉn Long', 'Gia Th·ªã M·ªπ', 'H√† VƒÉn Phong', 'Hoa Th·ªã Thanh',
      'La VƒÉn B√¨nh', 'Mai Th·ªã Chi', 'Nh·ªØ VƒÉn ƒê·∫°t', 'Ph√πng Th·ªã Hi·ªÅn',
      'Qu√°ch VƒÉn H∆∞ng', 'S·ª≠ Th·ªã Kh√°nh', 'T√¢n VƒÉn L√¢m', '·ª®ng Th·ªã Minh'
    ];

    const platforms = ['facebook', 'youtube', 'tiktok'];

    // Socket connection
    socket.on('connect', () => {
      updateStatus(true);
      addLog('ƒê√£ k·∫øt n·ªëi ƒë·∫øn server', 'success');
      subscribeToRoom();
    });

    socket.on('disconnect', () => {
      updateStatus(false);
      addLog('M·∫•t k·∫øt n·ªëi v·ªõi server', 'error');
    });

    // L·∫Øng nghe tr·∫°ng th√°i game t·ª´ Game View
    socket.on('onDucky', (data) => {
      console.log('Received action from Game View/Server:', data);
      
      if (data.action === 'pingController') {
        gameState = data.data;
        updateGameInfo();
      }
      
      if (data.action === 'changeGameStage') {
        gameState.state = data.data;
        updateGameInfo();
      }
      
      if (data.action === 'addedCharacter') {
        gameState.count = data.data;
        updateGameInfo();
      }
      
      // Hi·ªÉn th·ªã log cho c√°c l·ªánh ƒëi·ªÅu khi·ªÉn ƒë∆∞·ª£c g·ª≠i ƒëi
      if (['initGame', 'runGame', 'resetGame', 'showTopWinners', 'showResultList'].includes(data.action)) {
          addLog(`Server ƒë√£ ph·∫£n h·ªìi l·ªánh ƒëi·ªÅu khi·ªÉn: ${data.action}`, 'success');
      }
      
    });

    function updateStatus(connected) {
      const statusEl = document.getElementById('status');
      if (connected) {
        statusEl.textContent = 'ƒê√£ k·∫øt n·ªëi';
        statusEl.className = 'status connected';
      } else {
        statusEl.textContent = 'Ch∆∞a k·∫øt n·ªëi';
        statusEl.className = 'status disconnected';
      }
    }

    function updateGameInfo() {
      document.getElementById('gameState').textContent = gameState.state || '-';
      document.getElementById('playersCount').textContent = gameState.count || 0;
    }

    function addLog(message, type = '') {
      const logSection = document.getElementById('logSection');
      const logItem = document.createElement('div');
      logItem.className = `log-item ${type}`;
      const time = new Date().toLocaleTimeString('vi-VN');
      logItem.textContent = `[${time}] ${message}`;
      logSection.appendChild(logItem);
      logSection.scrollTop = logSection.scrollHeight;
    }

    function clearLogs() {
      document.getElementById('logSection').innerHTML = '<div class="log-item">S·∫µn s√†ng...</div>';
    }

    function subscribeToRoom() {
      currentRoomId = document.getElementById('inputRoomId').value;
      
      // Control Panel Subscribe ƒë·ªÉ nh·∫≠n c√°c th√¥ng b√°o chung c·ªßa ph√≤ng (room.config)
      socket.emit('call', 'live.subscribe', { id: currentRoomId }, (error) => {
        if (error) {
          console.error('Subscribe error:', error);
          addLog('L·ªói khi subscribe ph√≤ng', 'error');
        } else {
          console.log('Subscribed to room:', currentRoomId);
          document.getElementById('roomId').textContent = currentRoomId;
          addLog(`ƒê√£ subscribe v√†o ph√≤ng: ${currentRoomId}`, 'success');
          // Sau khi subscribe, g·ª≠i ping ƒë·ªÉ Game View g·ª≠i tr·∫°ng th√°i ng∆∞·ª£c l·∫°i
          sendAction('pingGameView');
        }
      });
    }

    async function saveConfig() {
      const config = {
        theme: document.getElementById('theme').value,
        keyword: document.getElementById('keyword').value,
        mode: document.getElementById('mode').value,
        timer: document.getElementById('timer').value,
        winnersCount: parseInt(document.getElementById('winnersCount').value),
        maxCharacters: parseInt(document.getElementById('maxCharacters').value),
        volume: parseInt(document.getElementById('volume').value),
        enableSound: document.getElementById('enableSound').checked,
        scoresForLike: 1,
        scoresForComment: 5,
        scoresForCent: 20
      };

      try {
        const response = await fetch(`${API_BASE_URL}/api/room/update-config`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            room: currentRoomId,
            config: config
          })
        });

        const result = await response.json();
        console.log('Config saved:', result);
        addLog('ƒê√£ l∆∞u c·∫•u h√¨nh th√†nh c√¥ng', 'success');
        alert('ƒê√£ l∆∞u c·∫•u h√¨nh th√†nh c√¥ng!');
      } catch (error) {
        console.error('Error saving config:', error);
        addLog('L·ªói khi l∆∞u c·∫•u h√¨nh', 'error');
        alert('L·ªói khi l∆∞u c·∫•u h√¨nh');
      }
    }

    // H√†m g·ª≠i l·ªánh ƒëi·ªÅu khi·ªÉn ƒë·∫øn server (Server s·∫Ω ph√°t l·∫°i ƒë·∫øn Game View)
    function sendAction(action, data = null) {
      socket.emit('call', 'load-comment.ducky', {
        room: currentRoomId,
        config: { action, data }
      }, (error) => {
        if (error) {
          console.error('Action error:', error);
          addLog(`L·ªói khi g·ª≠i action: ${action}`, 'error');
        } else {
          console.log('Action sent:', action);
          addLog(`ƒê√£ g·ª≠i action: ${action}`, 'info');
        }
      });
    }

    function initGame() {
      sendAction('initGame');
    }

    function runGame() {
      sendAction('runGame');
    }

    function resetGame() {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën l√†m m·ªõi game kh√¥ng?')) {
        sendAction('resetGame');
        addLog('G·ª≠i l·ªánh reset game', 'info');
        addedPlayers = [];
        updatePlayerList();
        
        // G·ªçi API ƒë·ªÉ x√≥a d·ªØ li·ªáu tr√™n Server (t√πy ch·ªçn)
        fetch(`${API_BASE_URL}/api/room/${currentRoomId}/reset`, { method: 'POST' });
      }
    }

    function showTopWinners() {
      sendAction('showTopWinners', true);
    }

    function showResultList() {
      sendAction('showResultList', true);
    }

    function getRandomName() {
      return vietnameseNames[Math.floor(Math.random() * vietnameseNames.length)];
    }

    function getRandomPlatform() {
      return platforms[Math.floor(Math.random() * platforms.length)];
    }

    async function addTestComment() {
      const playerName = document.getElementById('testPlayerName').value;
      const commentText = document.getElementById('testComment').value;
      
      const comment = {
        author: {
          id: 'test-user-' + Date.now(),
          name: playerName,
          avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(playerName)}&background=random`
        },
        platform: {
          name: 'facebook'
        },
        text: commentText,
      };

      try {
        await fetch(`${API_BASE_URL}/api/test/add-comment`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            room: currentRoomId,
            comment: comment
          })
        });
        addLog(`ƒê√£ th√™m comment t·ª´ ${playerName}`, 'success');
        addedPlayers.push(comment);
        updatePlayerList();
      } catch (error) {
        console.error('Error adding test comment:', error);
        addLog('L·ªói khi th√™m comment', 'error');
      }
    }

    async function addRandomComment() {
      const playerName = getRandomName();
      const platform = getRandomPlatform();
      const commentText = document.getElementById('keyword').value || 'streammix';
      
      const comment = {
        author: {
          id: 'player-' + Date.now() + '-' + Math.random(),
          name: playerName,
          avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(playerName)}&background=random`
        },
        platform: {
          name: platform
        },
        text: commentText,
      };

      try {
        await fetch(`${API_BASE_URL}/api/test/add-comment`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            room: currentRoomId,
            comment: comment
          })
        });
        addLog(`‚úÖ ƒê√£ th√™m ${playerName} (${platform})`, 'success');
        addedPlayers.push(comment);
        updatePlayerList();
        return true;
      } catch (error) {
        console.error('Error adding random comment:', error);
        addLog('‚ùå L·ªói khi th√™m ng∆∞·ªùi ch∆°i', 'error');
        return false;
      }
    }

    async function addRandomPlayers() {
      const count = parseInt(document.getElementById('autoPlayerCount').value);
      const interval = parseInt(document.getElementById('autoInterval').value);
      
      addLog(`B·∫Øt ƒë·∫ßu th√™m ${count} ng∆∞·ªùi ch∆°i ng·∫´u nhi√™n...`);
      
      for (let i = 0; i < count; i++) {
        if (gameState.count >= parseInt(document.getElementById('maxCharacters').value)) {
            addLog('ƒê√£ ƒë·∫°t s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i t·ªëi ƒëa!', 'warning');
            break;
        }
        await addRandomComment();
        await new Promise(resolve => setTimeout(resolve, interval));
      }
      
      addLog(`ƒê√£ ho√†n th√†nh th√™m ng∆∞·ªùi ch∆°i`, 'success');
    }

    function startAutoAddPlayers() {
      if (autoAddInterval) {
        addLog('Ch·∫ø ƒë·ªô t·ª± ƒë·ªông ƒë√£ ƒëang ch·∫°y', 'error');
        return;
      }
      
      const interval = parseInt(document.getElementById('autoInterval').value);
      
      addLog('B·∫Øt ƒë·∫ßu ch·∫ø ƒë·ªô t·ª± ƒë·ªông th√™m ng∆∞·ªùi ch∆°i', 'success');
      
      autoAddInterval = setInterval(() => {
        if (gameState.count >= parseInt(document.getElementById('maxCharacters').value)) {
             addLog('ƒê√£ ƒë·∫°t s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i t·ªëi ƒëa, d·ª´ng t·ª± ƒë·ªông.', 'warning');
             stopAutoAddPlayers();
             return;
        }
        addRandomComment();
      }, interval);
    }

    function stopAutoAddPlayers() {
      if (autoAddInterval) {
        clearInterval(autoAddInterval);
        autoAddInterval = null;
        addLog('ƒê√£ d·ª´ng ch·∫ø ƒë·ªô t·ª± ƒë·ªông', 'success');
      } else {
        addLog('Ch·∫ø ƒë·ªô t·ª± ƒë·ªông ch∆∞a ch·∫°y', 'error');
      }
    }

    function clearAllPlayers() {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a danh s√°ch ng∆∞·ªùi ch∆°i (ch·ªâ tr√™n Control Panel) v√† reset game kh√¥ng?')) {
        addedPlayers = [];
        updatePlayerList();
        addLog('ƒê√£ x√≥a danh s√°ch ng∆∞·ªùi ch∆°i (Control Panel)', 'success');
        resetGame(); // G·ª≠i l·ªánh reset game
      }
    }

    function updatePlayerList() {
      const playerList = document.getElementById('playerList');
      
      if (addedPlayers.length === 0) {
        playerList.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Ch∆∞a c√≥ ng∆∞·ªùi ch∆°i n√†o</div>';
        return;
      }
      
      playerList.innerHTML = addedPlayers.slice().reverse().slice(0, 50).map((player) => {
          const author = player.author || addedPlayers.author;
          const platformName = player.platform?.name || 'Unknown';
          const text = player.text || 'N/A';
          return `
            <div class="player-item">
              <img src="${author.avatar}" class="player-avatar" alt="${author.name}">
              <div style="flex: 1;">
                <strong>${author.name}</strong>
                <div style="font-size: 11px; color: #999;">${platformName} ‚Ä¢ ${text}</div>
              </div>
            </div>
          `;
      }).join('');
    }

    async function addTestLike() {
      // Logic t√¨m player ƒë√£ th√™m ƒë·ªÉ g·ª≠i reaction (d√πng addedPlayers cho ti·ªán test)
      if (addedPlayers.length === 0) {
        addLog('Ch∆∞a c√≥ ng∆∞·ªùi ch∆°i n√†o ƒë·ªÉ th√™m like', 'error');
        return;
      }

      const randomPlayer = addedPlayers[Math.floor(Math.random() * addedPlayers.length)];
      
      const reaction = {
        author: {
          id: randomPlayer.author.id
        },
        reaction: 'LIKE',
        metadata: {
          likeCount: 1
        },
      };

      try {
        await fetch(`${API_BASE_URL}/api/reactions/add`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            room: currentRoomId,
            author: reaction.author,
            reaction: reaction.reaction,
            metadata: reaction.metadata
          })
        });
        addLog(`üëç ƒê√£ th√™m like cho ${randomPlayer.author.name}`, 'success');
      } catch (error) {
        console.error('Error adding test like:', error);
        addLog('L·ªói khi th√™m like', 'error');
      }
    }

    async function addTestDonation() {
      if (addedPlayers.length === 0) {
        addLog('Ch∆∞a c√≥ ng∆∞·ªùi ch∆°i n√†o ƒë·ªÉ th√™m donation', 'error');
        return;
      }

      const randomPlayer = addedPlayers[Math.floor(Math.random() * addedPlayers.length)];
      const amount = Math.floor(Math.random() * 10) + 1;
      
      const reaction = {
        author: {
          id: randomPlayer.author.id
        },
        reaction: 'tiktok-donation',
        metadata: {
          giftInfo: {
            cost: amount
          }
        },
      };

      try {
        await fetch(`${API_BASE_URL}/api/reactions/add`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            room: currentRoomId,
            author: reaction.author,
            reaction: reaction.reaction,
            metadata: reaction.metadata
          })
        });
        addLog(`üí∞ ƒê√£ th√™m ${amount} coin cho ${randomPlayer.author.name}`, 'success');
      } catch (error) {
        console.error('Error adding test donation:', error);
        addLog('L·ªói khi th√™m donation', 'error');
      }
    }

    // Initialize
    document.getElementById('inputRoomId').addEventListener('change', subscribeToRoom);
    
    // Auto update player list
    updatePlayerList();

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      stopAutoAddPlayers();
    });
  </script>
</body>
</html>